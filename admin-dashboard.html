<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root{--nav-bg:#0b1320;--accent:#ff9800}
    body{font-family:Inter,Segoe UI,system-ui; background:#f4f6f9; margin:0}
    .navbar{background:var(--nav-bg)!important}
    .navbar .nav-link{color:#fff!important}
    .navbar .nav-link i{font-size:20px;color:#fff;transition:color .2s}
    .navbar .nav-link:hover i,.navbar .nav-link.show i{color:var(--accent)}
    .page-title{margin:28px 0}
    .card{border:none;border-radius:12px;box-shadow:0 6px 18px rgba(11,19,32,.06)}
    .stat {font-weight:700; font-size:1.35rem}
    .small-muted{color:#6c757d}
    .table-actions .btn{margin-right:6px}
    .dropdown-header{font-size:.85rem; font-weight:600}
    .badge-pending{background:#fff3cd;color:#856404;border:1px solid  #FEA116}
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand text-white" href="index.html">Artistic Creation</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navMain">
      <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="products.html">Products</a></li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-fill"></i>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
            <!-- Admin -->
            <li><h6 class="dropdown-header">Admin</h6></li>
            <li><a class="dropdown-item" href="admin-dashboard.html">Dashboard</a></li>
            <li><a class="dropdown-item" href="manage-users.html">Manage Users</a></li>
            <li><a class="dropdown-item" href="admin-settings.html">Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <!-- Buyer -->
            <li><h6 class="dropdown-header">Buyer</h6></li>
            <li><a class="dropdown-item" href="buyer-orders.html">My Orders</a></li>
            <li><a class="dropdown-item" href="buyer-wishlist.html">Wishlist</a></li>
            <li><a class="dropdown-item" href="buyer-settings.html">Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <!-- Seller -->
            <li><h6 class="dropdown-header">Seller</h6></li>
            <li><a class="dropdown-item" href="seller-dashboard.html">Dashboard</a></li>
            <li><a class="dropdown-item" href="seller-products.html">My Products</a></li>
            <li><a class="dropdown-item" href="seller-orders.html">Orders</a></li>
            <li><a class="dropdown-item" href="seller-settings.html">Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="logout.html">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- MAIN -->
<div class="container">
  <div class="page-title d-flex justify-content-between align-items-center">
    <div>
      <h2 class="mb-0">Admin Dashboard</h2>
      <small class="small-muted">Overview & quick actions</small>
    </div>
    <div>
      <button class="btn btn-outline-secondary me-2" id="refreshBtn"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
      <a class="btn btn-warning text-white" href="manage-users.html"><i class="bi bi-people-fill"></i> Manage Users</a>
    </div>
  </div>

  <!-- Stats -->
  <div class="row g-4">
    <div class="col-md-3">
      <div class="card p-3">
        <div class="d-flex justify-content-between">
          <div>
            <div class="small-muted">Total Users</div>
            <div class="stat" id="statUsers">1,280</div>
          </div>
          <div class="text-end">
            <i class="bi bi-people-fill fs-2 text-warning"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card p-3">
        <div class="d-flex justify-content-between">
          <div>
            <div class="small-muted">Active Sellers</div>
            <div class="stat" id="statSellers">182</div>
          </div>
          <div class="text-end">
            <i class="bi bi-shop-window fs-2 text-success"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card p-3">
        <div class="d-flex justify-content-between">
          <div>
            <div class="small-muted">Monthly Orders</div>
            <div class="stat" id="statOrders">3,420</div>
          </div>
          <div class="text-end">
            <i class="bi bi-basket3 fs-2 text-primary"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card p-3">
        <div class="d-flex justify-content-between">
          <div>
            <div class="small-muted">Revenue</div>
            <div class="stat" id="statRevenue">₹1.2M</div>
          </div>
          <div class="text-end">
            <i class="bi bi-currency-dollar fs-2 text-danger"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart + Quick Table -->
  <div class="row mt-4 g-4">
    <div class="col-lg-8">
      <div class="card p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Sales This Year</h5>
          <small class="small-muted">Monthly breakdown</small>
        </div>
        <canvas id="salesChart" height="140"></canvas>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card p-3">
        <h6 class="mb-3">Recent Signups</h6>
        <ul class="list-unstyled mb-0" id="recentUsers">
          <!-- JS will populate -->
        </ul>
      </div>
    </div>
  </div>

  <!-- Recent Orders Table -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Recent Orders</h5>
          <small class="small-muted">Latest 8 orders</small>
        </div>

        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Buyer</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Placed</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="recentOrdersTable">
              <!-- JS fills -->
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>

</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Fetch Stats
  function fetchStats() {
      fetch('http://localhost:3000/api/stats')
          .then(res => res.json())
          .then(data => {
              document.getElementById('statUsers').innerText = data.users;
              document.getElementById('statSellers').innerText = data.sellers || 0; // Fallback if not implemented in stats.js yet
              document.getElementById('statOrders').innerText = data.orders;
              document.getElementById('statRevenue').innerText = '₹' + parseFloat(data.revenue).toLocaleString();
          })
          .catch(err => console.error(err));
  }

  // Fetch Recent Orders
  function fetchRecentOrders() {
      fetch('http://localhost:3000/api/orders?role=admin')
          .then(res => res.json())
          .then(data => {
              const tbody = document.getElementById('recentOrdersTable');
              tbody.innerHTML = '';
              data.slice(0, 8).forEach(order => {
                  const tr = document.createElement('tr');
                  tr.innerHTML = `
                      <td>#${order.id}</td>
                      <td>${order.buyer_name || 'Unknown'}</td>
                      <td>₹${order.total_amount}</td>
                      <td><span class="badge bg-${getStatusColor(order.status)}">${order.status}</span></td>
                      <td>${new Date(order.created_at).toLocaleDateString()}</td>
                      <td><button class="btn btn-sm btn-light">View</button></td>
                  `;
                  tbody.appendChild(tr);
              });
          });
  }

  function getStatusColor(status) {
      if(status === 'pending') return 'warning';
      if(status === 'shipped') return 'info';
      if(status === 'delivered') return 'success';
      return 'secondary';
  }

  document.addEventListener('DOMContentLoaded', () => {
      fetchStats();
      fetchRecentOrders();
      
      // Dummy Chart
      new Chart(document.getElementById('salesChart'), {
          type: 'line',
          data: {
              labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
              datasets: [{
                  label: 'Sales',
                  data: [12, 19, 3, 5, 2, 3],
                  borderColor: '#ff9800',
                  tension: 0.4
              }]
          },
          options: { responsive: true }
      });
  });
</script>
</body>
</html>
